<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Hero Game - Final Ajustado</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background-color: #222; display: flex; justify-content: center; align-items: center; height: 100vh; }
    </style>
</head>
<body>
    <script>
        const config = {
            type: Phaser.CANVAS, 
            width: 800,
            height: 600,
            backgroundColor: '#2d3436',
            physics: {
                default: 'arcade',
                arcade: { debug: false }
            },
            scene: { preload, create, update }
        };

        const game = new Phaser.Game(config);
        
        let player, cursors, keySpace, fomeText, pontosText, paredes, npcVermelho, npcPreto;
        let fome = 100;
        let pontos = 0;
        let gameOver = false;
        let isPaused = false;
        let pauseText, btnReset, txtReset;

        const mapa = [
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,0,1,0,1,1,1,1,0,1,1,1,1,1,0,1,0,1],
            [1,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,1],
            [1,0,1,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,0,1],
            [1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,1],
            [1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1],
            [1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1],
            [1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1],
            [1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1], // Linha 10 (Índice 10)
            [1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], // Linha 11 (Índice 11) - Espaço livre aqui
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ];

        function preload() {
            this.load.image('boneco', 'hero_all_black.png');
            
            const criarCor = (nome, cor, w, h, arredondado = false) => {
                if(this.textures.exists(nome)) return; 
                let canvas = this.textures.createCanvas(nome, w, h);
                canvas.context.fillStyle = cor;
                if(arredondado) {
                    canvas.context.beginPath();
                    canvas.context.arc(w/2, h/2, w/2, 0, Math.PI * 2);
                    canvas.context.fill();
                } else {
                    canvas.context.fillRect(0, 0, w, h);
                }
                canvas.refresh();
            };

            criarCor('wallTex', '#636e72', 38, 38);
            criarCor('foodTex', '#2ecc71', 16, 16, true);
            criarCor('npcRedTex', '#ff0000', 30, 30);
            criarCor('npcBlackTex', '#000000', 30, 30);
            criarCor('btnTex', '#e67e22', 300, 60);
        }

        function create() {
            this.input.on('pointerdown', () => this.input.keyboard.focus());
            this.input.keyboard.removeAllKeys();

            gameOver = false;
            isPaused = false;
            fome = 100;
            pontos = 0;

            paredes = this.physics.add.staticGroup();
            for (let row = 0; row < mapa.length; row++) {
                for (let col = 0; col < mapa[row].length; col++) {
                    if (mapa[row][col] === 1) {
                        paredes.create(col * 40 + 20, row * 40 + 20, 'wallTex');
                    }
                }
            }

            player = this.physics.add.sprite(60, 60, 'boneco');
            player.setDisplaySize(45, 45);
            player.body.setSize(180, 220); 
            player.setCollideWorldBounds(true);

            // === AJUSTE DE POSIÇÃO AQUI ===
            // Mudei o NPC Vermelho para uma posição segura (já estava ok)
            npcVermelho = this.physics.add.sprite(400, 300, 'npcRedTex'); 
            
            // Mudei o NPC Preto de (700, 400) para (620, 460).
            // (620, 460) fica no meio de um corredor vazio na parte de baixo do mapa.
            npcPreto = this.physics.add.sprite(620, 460, 'npcBlackTex'); 

            configurarNPC(this, npcVermelho, 120, false);
            configurarNPC(this, npcPreto, 160, true);

            this.physics.add.collider(player, paredes);

            fomeText = this.add.text(20, 20, 'FOME: 100%', { fontSize: '24px', fill: '#fff', backgroundColor: '#00000088', padding: { x: 10, y: 5 }});
            pontosText = this.add.text(780, 20, 'PONTOS: 0', { fontSize: '24px', fill: '#f1c40f', backgroundColor: '#00000088', padding: { x: 10, y: 5 }}).setOrigin(1, 0);
            
            pauseText = this.add.text(400, 250, 'PAUSADO', { fontSize: '64px', fill: '#fff' }).setOrigin(0.5).setVisible(false).setDepth(101);

            btnReset = this.add.image(400, 350, 'btnTex').setVisible(false).setDepth(100);
            txtReset = this.add.text(400, 350, 'ESPAÇO PARA RECOMEÇAR', { fontSize: '20px', fill: '#fff', fontWeight: 'bold' }).setOrigin(0.5).setVisible(false).setDepth(101);

            const foods = this.physics.add.group();
            const gerarComida = () => {
                let r, c; do { r = Phaser.Math.Between(1, mapa.length - 2); c = Phaser.Math.Between(1, mapa[0].length - 2); } while (mapa[r][c] !== 0);
                foods.create(c * 40 + 20, r * 40 + 20, 'foodTex');
            }
            for(let i = 0; i < 6; i++) gerarComida();

            this.physics.add.overlap(player, foods, (p, f) => {
                f.destroy();
                fome = Math.min(fome + 20, 100);
                pontos += 10;
                pontosText.setText('PONTOS: ' + pontos);
                gerarComida();
            });

            cursors = this.input.keyboard.createCursorKeys();
            keySpace = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

            this.time.addEvent({
                delay: 1000,
                callback: () => { if(fome > 0 && !gameOver && !isPaused) fome -= 1.5; },
                loop: true
            });
        }

        function mudarDirecao(entidade, velocidade) {
            if (!entidade || !entidade.body) return;
            if (gameOver || isPaused || fome <= 0) { 
                if(entidade.body) entidade.setVelocity(0); 
                return; 
            }
            const escolhas = [{x: velocidade, y: 0}, {x: -velocidade, y: 0}, {x: 0, y: velocidade}, {x: 0, y: -velocidade}];
            const dir = Phaser.Utils.Array.GetRandom(escolhas);
            entidade.setVelocity(dir.x, dir.y);
        }

        function configurarNPC(scene, entidade, velocidade, ehInimigo) {
            entidade.setCollideWorldBounds(true).setImmovable(true);
            entidade.body.setSize(30, 30);

            scene.physics.add.collider(entidade, paredes, () => {
                // === AJUSTE DE COLISÃO ===
                // Reduzi de 5 para 2 para evitar que ele pule muros ou vibre demais
                if (entidade.body.touching.left) entidade.x += 2;
                if (entidade.body.touching.right) entidade.x -= 2;
                if (entidade.body.touching.up) entidade.y += 2;
                if (entidade.body.touching.down) entidade.y -= 2;
                mudarDirecao(entidade, velocidade);
            });

            if (ehInimigo) scene.physics.add.overlap(player, entidade, () => finalizarJogo(scene, 'VOCÊ MORREU!'));
            else scene.physics.add.collider(player, entidade);

            mudarDirecao(entidade, velocidade);
            scene.time.addEvent({ delay: 2500, callback: () => mudarDirecao(entidade, velocidade), loop: true });
        }

        function finalizarJogo(scene, mensagem) {
            if (gameOver) return;
            gameOver = true;
            fomeText.setText(mensagem);
            
            if(player && player.body) {
                player.setTint(0xff0000);
                player.body.enable = false;
            }
            if(npcVermelho && npcVermelho.body) npcVermelho.body.enable = false;
            if(npcPreto && npcPreto.body) npcPreto.body.enable = false;
            
            btnReset.setVisible(true);
            txtReset.setVisible(true);
        }

        function update() {
            if (!player || !player.body) return;

            if (Phaser.Input.Keyboard.JustDown(keySpace)) {
                if (gameOver) {
                    this.scene.restart();
                    return;
                } else {
                    isPaused = !isPaused;
                    if (isPaused) {
                        this.physics.pause();
                        pauseText.setVisible(true);
                    } else {
                        this.physics.resume();
                        pauseText.setVisible(false);
                        if(npcVermelho && npcVermelho.body) mudarDirecao(npcVermelho, 120);
                        if(npcPreto && npcPreto.body) mudarDirecao(npcPreto, 160);
                    }
                }
            }

            if (gameOver || isPaused) return;

            const speed = 200;
            player.setVelocity(0);

            if (fome > 0) {
                if (cursors.left.isDown) player.setVelocityX(-speed);
                else if (cursors.right.isDown) player.setVelocityX(speed);
                if (cursors.up.isDown) player.setVelocityY(-speed);
                else if (cursors.down.isDown) player.setVelocityY(speed);
                if (player.body.velocity.x !== 0 && player.body.velocity.y !== 0) player.body.velocity.normalize().scale(speed);
            }

            fomeText.setText('FOME: ' + Math.floor(fome) + '%');
            if (fome <= 0) finalizarJogo(this, 'FIM DE JOGO!');
        }
    </script>
</body>
</html>